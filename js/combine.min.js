$(document).ready(function(){var t={domTocode:function(t){var e="";return e+="<!DOCTYPE html>\r\n",e+="<html>\r\n",e+="<head>\r\n",e+='<meta charset="UTF-8">\r\n',e+='<meta name="description" content="'+t.description+'" />\r\n',e+='<meta name="keywords" content="'+t.keywords+'" />\r\n',e+="<title>"+t.title+"</title>\r\n",e+='<link href="css/global.css" rel="stylesheet" />\r\n',e+="</head>\r\n",e+="<body>\r\n",e+=this.getBody(t.sectionData),e+="\r\n",e+="\r\n",e+="\r\n",e+="\r\n",e+="\r\n",e+=this.getFrameworkLink(t.addFrameworkArr)+"\r\n",e+=this.getAddScript(t.addScript)+"\r\n",e+="</body>\r\n",e+="</html>\r\n"},getFrameworkLink:function(t){var e="",n={Jquery:"https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js",JqueryCookie:"https://cdn.bootcss.com/jquery-cookie/1.4.0/jquery.cookie.min.js"};return t.map(function(t,i){e+='<script src="'+n[t]+'" type=text/javascript><\/script>'}),e},getAddScript:function(t){var e="";return e+="<script>",e+=t,e+="<\/script>"},domToCss:function(t,e){var n="";return n+="* {margin: 0; padding: 0;}\r\n",n+='body, textarea, input, button, select, keygen, legend{font:14px "Microsoft YaHei", Verdana, "宋体", sans-serif; font-weight: normal; color: #666666; outline: 0;}\r\n',n+="header, footer, section, article, aside, nav, address, figure, figcaption, menu, details {display:block;}\r\n",n+="h1, h2, h3, h4, h5, h6 {font-weight: normal;}\r\n",n+="table {border-collapse: collapse; border-spacing: 0;}\r\n",n+="caption, th {text-align:left;font-weight: normal;}\r\n",n+="html, body, fieldset, img, iframe, abbr{border: 0;}\r\n",n+="i, cite, em, var, address, dfn{font-style: normal;}\r\n",n+="summary{outline: 0;}\r\n",n+="ul, li{list-style: none;}\r\n",n+="img {vertical-align: middle;}\r\n",n+="a, a:hover{text-decoration: none; cursor: pointer;}\r\n",n+="a:link {color: #666666;}\r\n",n+="a:visited {color: #666666;}\r\n",n+="a:hover {color: #C91618;}\r\n",n+="a:active {color: #666666;}\r\n",n+=".outer-section {width: 100%}\r\n",n+=".outer-wrapper {width: "+t+"px; margin: 0 auto;}\r\n",n+=".outer-wrapper .columns ul {clear: both}\r\n",n+=".outer-wrapper .columns li {float: left}\r\n",n+="\r\n",n+="\r\n",n+="\r\n"},getBody:function(t){var e="";return t.length>0?t.map(function(t,n){e+='<div class="outer-section">\r\n',e+='<div class="outer-wrapper">\r\n',e+='<div class="columns">\r\n',e+="<ul>\r\n",t.columns.map(function(t,i){e+='<li style="width:'+t.width+'px">\r\n',t.link&&(e+='<a href="'+t.link+'" title="" target="_blank">\r\n'),e+='<img src="images/qd_S'+n+"_C"+i+'.png" alt="" />\r\n',t.link&&(e+="</a>\r\n"),e+="</li>\r\n"}),e+="</ul>\r\n",e+="</div>\r\n",e+="</div>\r\n",e+="</div>\r\n"}):e="\r\n",e}};window.qtTemp=t}),$(document).ready(function(){var t=0,e=0,n=new Image,i=document.getElementById("myCanvas"),o=i.getContext("2d"),r=!1,a=[],l=[],s="",c={init:function(){this.bindEvent()},bindEvent:function(){var n=this;$("#loadimage").on("change",function(){var t=$(this).prop("files");n.loadImg(t[0])}),$("#append").click(function(){r?($(this).parents("li").siblings().removeClass("on"),n.appendOuter()):alert("请选上传图片!")}),$("#myPannel").on("click",".removeIt",function(){var t=$(this).parents(".outer-section").data("index");n.mergerow(t)}),$("#myPannel").on("change",".outer-height",function(t){var e=$(this).parents(".outer-section").data("index"),i=$(this).val();a[e].height=i,n.renderSection()}),$("#myPannel").on("click",".split-columns",function(t){if(console.log(t.target.className),"split-columns"===t.target.className){var e=$(this).parents(".outer-section").data("index"),n=$(this).offset(),i=a[e].height,o=1*n.top+1*i-45-30+"px",r=n.left+"px";$(this).parents(".outer-section").addClass("cur").siblings().removeClass("cur"),$(".split-columns").removeClass("cur-col"),$(this).addClass("cur-col"),$("#myWidgets").css({top:o,left:r}).show()}}),$("#mergerow").click(function(){var t=$(".outer-section.cur").data("index");n.mergerow(t)}),$("#splitrow").click(function(){var e=$(".outer-section.cur").data("index"),i=a[e].height,o=Math.ceil(i/2);a[e].height=o,a.splice(e,0,{height:o,columns:[{width:t}]}),n.renderSection()}),$("#columns").click(function(){for(var e=$(".outer-section.cur").data("index"),i=a[e].columns.length,o=Math.ceil(t/(i+1)),r=[],l=0;l<i+1;l++)r.push({width:o});a[e].columns=r,n.renderSection()}),$("#myPannel").on("change",".set-columns-width input",function(t){var e=t.currentTarget.defaultValue,i=$(this).data("index"),o=$(this).data("col"),r=$(this).val(),l=a[i].columns.length;a[i].columns[o].width=r,console.log(l,o),l>1&&(o==l-1?a[i].columns[o-1].width=1*a[i].columns[o-1].width+1*(e-r):a[i].columns[o+1].width=1*a[i].columns[o-1].width+1*(e-r)),n.renderSection()}),$("#link").click(function(){var t=$(".outer-section.cur").data("index"),e=$(".outer-section.cur").find(".split-columns.cur-col").data("col");$("#linkDialog").find('input[name="index"]').val(t),$("#linkDialog").find('input[name="col"]').val(e),a[t].columns[e].link?$("#linkDialogInput").val(a[t].columns[e].link):$("#linkDialogInput").val(""),$("#linkDialog").show()}),$("#linkDialogSubmit").click(function(){var t=$("#linkDialog").find('input[name="index"]').val(),e=$("#linkDialog").find('input[name="col"]').val(),n=$("#linkDialogInput").val();a[t].columns[e].link=n,$(this).parents(".qtDialog").hide()}),$(".qtDialog .close").click(function(){$(this).parents(".qtDialog").hide()}),$("#export").click(function(){r?$(this).parents("li").addClass("on").siblings().removeClass("on"):alert("请选上传图片!")}),$("#export-zip").click(function(){var t=$("#export").parents("li").find('input[name="title"]').val(),e=$("#export").parents("li").find('input[name="keywords"]').val(),i=$("#export").parents("li").find('textarea[name="description"]').val();n.exportZip(t,e,i),$(this).parents("li").removeClass("on")}),$("#clear").click(function(){a=[],n.renderSection()}),$("#code").click(function(){}),$("#setup").click(function(){r?$(this).parents("li").addClass("on").siblings().removeClass("on"):alert("请选上传图片!")}),$("#setupDoing").click(function(){var i,o=$("#autoSection").is(":checked"),r=$("#addFramework").find('input[type="checkbox"]');if(l=[],s=$("#addScript").val(),r.map(function(t,e){$(e).is(":checked")&&l.push($(e).val())}),o&&0==a.length){i=Math.floor(e/100);for(var c=0;c<i;c++)a.push({height:100,columns:[{width:t}]});i<e/100&&a.push({height:e-100*i,columns:[{width:t}]})}n.renderSection(),$(this).parents("li").removeClass("on")})},mergerow:function(t){a.length>t+1?(a[t].height=1*a[t].height+1*a[t+1].height,a.splice(t+1,1),this.renderSection()):(a.splice(t,1),this.renderSection())},loadImg:function(a){var l=this,s=new FileReader;s.readAsDataURL(a),s.onload=function(a){n.onload=function(){t=i.width=n.width,e=i.height=n.height,o.clearRect(0,0,t,e),o.drawImage(n,0,0),$("#entry").slideUp("fast").remove(),$("#main").height(e),$("#myCanvas").show("fast","linear",function(){l.adaptive(!0)})},n.src=a.target.result,r=!0}},adaptive:function(){var n=$(document).width(),i=t>n?n:t,o=e,r=(n-t)/2,a={"margin-left":Math.ceil(r),"margin-right":Math.floor(r)},l={width:i,height:o};$("#main").width(n),$("#myCanvas").css(a),r>0&&jQuery.extend(l,a),$("#myPannel").css(l),$("#myPicker").css(l)},appendOuter:function(){a.push({height:100,columns:[{width:t}]}),this.renderSection()},renderSection:function(){var e="";a.map(function(n,i){e+='<div class="outer-section" style="height:'+n.height+'px" data-index="'+i+'">',e+='<div class="removeIt"></div>',e+='<div class="outer-handler">',e+="<em>S"+(i+1)+"</em>",e+='<span>height:<input class="outer-height" type="text" value="'+n.height+'"/>px</span>',e+="</div>",e+='<div class="outer-wrapper" style="width: '+t+'px">',n.columns.map(function(t,o){e+='<div class="split-columns" data-index="'+i+'" data-col="'+o+'" style="height: '+n.height+"px; width: "+t.width+'px">',e+='<div class="set-columns-width">',e+='<input type="text" data-index="'+i+'" data-col="'+o+'" value="'+t.width+'"/>',e+="</div>",e+="</div>"}),e+="</div>",e+="</div>"}),$("#myPannel").html(e),$("#myWidgets").hide()},exportZip:function(e,n,i){function r(t,e,n,i,r){var a=document.getElementById("tempCanvas"),l=a.getContext("2d"),s=o.getImageData(t,e,n,i);n!=a.width&&(a.width=n),i!=a.height&&(a.height=i),l.clearRect(0,0,a.width,a.height),l.putImageData(s,0,0);var d=a.toDataURL("image/png").split(",")[1];c.file("images/qd_"+r+".png",d,{base64:!0})}console.log(e,n,i);var c=new JSZip;$(".split-columns").each(function(t,e){var n=$(e).offset(),i=$("#myCanvas").offset(),o=$(e).data("index"),a=$(e).data("col");r(n.left-i.left-1,n.top-i.top-1,$(e).outerWidth(),$(e).outerHeight(),"S"+o+"_C"+a)}),c.file("index.html",qtTemp.domTocode({sectionData:a,title:e,keywords:n,description:i,addFrameworkArr:l,addScript:s})),c.file("css/global.css",qtTemp.domToCss(t)),c.generateAsync({type:"blob"}).then(function(t){var e=new FileReader;e.onloadend=function(t){window.location.href=t.target.result},e.readAsDataURL(t)})}};c.init(),window.qtTools=c});